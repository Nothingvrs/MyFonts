# MyFonts Backend

API для определения кириллических шрифтов по изображениям.

## Технологии

- **FastAPI** - современный веб-фреймворк для API
- **OpenCV** - библиотека компьютерного зрения для анализа изображений
- **Pillow** - обработка изображений
- **NumPy** - математические операции
- **scikit-learn** - машинное обучение для сопоставления шрифтов

## Установка

1. Создайте виртуальное окружение:

```bash
python -m venv venv
venv\Scripts\activate  # Windows
# или
source venv/bin/activate  # Linux/Mac
```

2. Установите зависимости:

```bash
pip install -r requirements.txt
```

## Запуск

### Режим разработки

```bash
python run.py
```

### Прямой запуск через uvicorn

```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

API будет доступен по адресу: `http://localhost:8000`

## Документация API

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

## Основные endpoints

### `POST /api/analyze-font`

Анализ шрифта по загруженному изображению.

**Параметры:**

- `file` - файл изображения (PNG, JPG, JPEG, GIF, BMP, WebP)

**Ответ:**

```json
{
  "success": true,
  "message": "Анализ завершен успешно",
  "matches": [
    {
      "font_info": {
        "name": "Times New Roman",
        "category": "serif",
        ...
      },
      "confidence": 0.85,
      "match_details": {...}
    }
  ],
  "characteristics": {...}
}
```

### `GET /api/fonts`

Получение списка всех шрифтов.

**Параметры:**

- `category` (опционально) - фильтр по категории

### `GET /api/fonts/{font_id}`

Получение информации о конкретном шрифте.

### `GET /api/fonts/search/{query}`

Поиск шрифтов по названию.

## Структура проекта

```
backend/
├── app/
│   ├── main.py              # FastAPI приложение
│   ├── models/              # Pydantic модели
│   │   └── font_models.py
│   ├── services/            # Бизнес-логика
│   │   ├── font_analyzer.py # Анализ изображений
│   │   └── font_matcher.py  # Сопоставление шрифтов
│   ├── database/            # База данных
│   │   └── font_database.py # Управление данными шрифтов
│   └── utils/               # Утилиты
├── requirements.txt         # Python зависимости
├── run.py                  # Скрипт запуска
└── README.md              # Документация
```

## Особенности анализа

### Анализ изображений

- Определение наличия текста на изображении
- Извлечение характеристик шрифта (засечки, толщина штрихов, контраст)
- Анализ геометрических параметров (высота букв, интервалы)
- Специальный анализ кириллических особенностей

### Сопоставление шрифтов

- Взвешенное сравнение характеристик
- Приоритет кириллических особенностей
- Ранжирование по уверенности
- Детальные метрики совпадения

## Разработка

### Добавление новых шрифтов

Редактируйте файл `app/database/font_database.py` и добавьте новые записи в метод `_initialize_fonts()`.

### Настройка весов сопоставления

Измените веса в `app/services/font_matcher.py` в конструкторе класса `FontMatcher`.

### Улучшение анализа

Модифицируйте методы в `app/services/font_analyzer.py` для более точного извлечения характеристик.

## Логирование

Все операции логируются с уровнем INFO. Для изменения уровня логирования измените настройки в `main.py`.

## CORS

Настроены разрешения для работы с фронтендом на портах 3000 (React) и 5173 (Vite).

